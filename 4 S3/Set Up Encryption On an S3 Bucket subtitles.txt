Hello, Cloud Gurus and welcome
to this lecture, so in this lecture,
this is going to be a lab and we are going to
be setting up encryption on an S3 bucket.
So if you'd like to join me
in the console, let's get started.
So here we are in the AWS console.
And the first thing that we're going to do in this lab
is we're going to create a new S3 bucket,
then we're going to add a policy
to enforce the use of server side encryption.
Then we're going to test that policy works.
So we're going to test it by attempting to upload a file
without using the encryption option.
So first of all, we need to select S3 in the main console,
and we go to create bucket
and we just create our new bucket here. I'm just
going to keep the region as Frankfurt and click Next.
And there are two ways to enable encryption.
So you can either enable it at the console
which is the easiest way and all you do is check
the default encryption box and you can choose between
the AES-256 which is the S3 managed case,
or the AWS KMS, which is the KMS managed keys.
And both of those are server side encryption.
But you can also enforce encryption
on your S3 bucket by using an S3 bucket policy.
And for this lab, that's exactly what we're going to do.
So we're not going to enable it here.
So I'm just going to deselect that,
we're actually going to enable it using a bucket policy.
So just go ahead and click next, next, and create bucket.
There we go, so if we go into the bucket,
hit permissions, and go to bucket policies.
So now we need to create the bucket policy
that's going to enforce encryption on our files.
So let's go to policy generator.
And this is where we're going to build our policy.
So the type of policy is going to be an S3 bucket policy,
and the effect is going to be deny.
We're going to be denying requests
which do not enforce encryption.
So the principle will be start that will apply
to any request get the AWS service as Amazon S3.
And then for action, just scroll down
until you find put object.
So it's right down here.
There we put objects and just select that,
Amazon resource name, so that is the name of your bucket.
So if you just come back to your console screen,
copy the bucket ARN and at the end.
And then we need to add a condition.
So the condition is going to be string
so it's going to catch when the string does not equal.
AMZ server side encryption
and then your value will be the type
of encryption that we're specifying so let's use KMS.
So just enter AWS colon KMS.
And then we'll hit add condition,
and then go ahead and hit add statement and generate policy.
So this is the JSON code
that the policy generator has created for us.
So here you can see no policy document,
we've got policy ID, a policy version,
and then the statement, which is the action
that's going to the policy is going to enforce.
So we've got statement ID, and then the action
which relates to the put of new objects that every time
you upload a new file, and the effect
will be deny for this resource.
So for this bucket name, so deny any request
to put a new objects where the string
does not equal XMZ server side encryption,
AWS, KMS and then principle a star
so that means anybody who tries
to upload a file into this bucket
without using server side encryption is going to be denied.
So we need to copy this code
that's been generated by the policy generator.
And go back to our console and add in the code here.
Hit save, okay and straightaway,
we've seen an error message.
And I wanted to show you this error message
because this is something that you see sometimes
when you create new policies using the policy editor,
so the error that we've got here saying,
action does not apply to resources in statement.
So we look at the resource section, which is here,
where we've added our Amazon resource name.
So it's complaining that the action
does not apply to this resource.
So this happens sometimes, just because some services
do not let you specify specific actions
for individual resources and in this case,
you need to usually need to add
a wild card to the resource element.
So that just means that the action
will apply to all resources within that service,
not just that bucket, so everything within the bucket.
So if you do see this error message,
you can normally resolve it just by adding a wild card.
So we'll do that now.
So we just add forward slash and star.
And that should fix our problem.
Yep, so is accepted that policy now.
And we are ready to go ahead
and test that policy is working correctly.
So go back to your bucket.
we're going to try and upload
an object so go to add files.
And I'm just going to select a text file from my machine,
you can just select any file
that you have on your local machine and click next,
next, and if we scroll down on this set properties section
we'll find the encryption field here
and we're just going to keep encryption to none.
So you've got the choice where you can either use encryption
with an S3 master key or the KMS manage master key.
So you have the two options there,
but we're just going to keep it to none
and click next, and then upload.
And we should see that that has actually failed,
so it's failed to upload the object.
And right at the bottom,
you can see that we've got one error.
So if we click on the error, and then click on Upload,
it will give us the message and it just says
that this was a forbidden action.
Okay, so let's try again we're going to try
and upload another file and this time
we're going to use encryption so just click on upload.
And you can just choose any file from your machine.
I'm just going to select one from my documents,
click open, next, next, and then scroll down to encryption.
And we're going to select AWS KMS and just select AWS S3,
then click on next and upload.
And there we are that should be successful.
So let's try and upload another file
and use a different method of encryption.
So I'm just going to select another file from my documents.
Click next, next, scroll down to the encryption section.
And I'm going to select using the Amazon S3 master key.
Click next and upload.
So once again, that should show you the same error message.
So if I click on the error message, click on Upload.
Once again, it shows me that that was forbidden.
So that is the end of this lab.
So we've created our S3 bucket,
we enforce the use of server side encryption.
And just remember there's two ways to do that.
So you can do it really easily on the console
just using the checkbox or you can also enforce
it using a policy and when we enforce server side encryption
within S3, this means that S3 will forbid any attempts
to upload a file without using
the specified method of encryption.
So that is the end of this lecture.
If you have any questions, please let me know.
If not, feel free to move on to the next lecture, thank you.